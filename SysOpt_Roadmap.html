<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SysOpt 2.2.0 ‚Äî Hoja de Ruta</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg:       #0D0F1A;
    --card:     #131625;
    --card2:    #1A1E2F;
    --border:   #252B40;
    --blue:     #5BA3FF;
    --cyan:     #2EDFBF;
    --amber:    #FFB547;
    --red:      #FF6B84;
    --green:    #4AE896;
    --purple:   #9B7EFF;
    --txt:      #E8ECF4;
    --muted:    #7880A0;
    --mono:     'JetBrains Mono', monospace;
    --sans:     'Syne', sans-serif;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--txt);
    font-family: var(--sans);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(91,163,255,.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(91,163,255,.04) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .blob {
    position: fixed;
    border-radius: 50%;
    filter: blur(120px);
    opacity: .12;
    pointer-events: none;
    z-index: 0;
    animation: drift 18s ease-in-out infinite alternate;
  }
  .blob-1 { width:500px; height:500px; background:#5BA3FF; top:-100px; left:-100px; }
  .blob-2 { width:400px; height:400px; background:#2EDFBF; bottom:0; right:0; animation-delay:-9s; }
  .blob-3 { width:300px; height:300px; background:#9B7EFF; top:50%; left:50%; transform:translate(-50%,-50%); animation-delay:-4s; }

  @keyframes drift {
    from { transform: translate(0,0) scale(1); }
    to   { transform: translate(30px,20px) scale(1.08); }
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1100px;
    margin: 0 auto;
    padding: 60px 24px 100px;
  }

  header {
    text-align: center;
    margin-bottom: 72px;
  }

  .version-badge {
    display: inline-block;
    font-family: var(--mono);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--green);
    background: rgba(74,232,150,.1);
    border: 1px solid rgba(74,232,150,.25);
    border-radius: 100px;
    padding: 4px 14px;
    margin-bottom: 20px;
  }

  h1 {
    font-size: clamp(2.2rem, 5vw, 3.8rem);
    font-weight: 800;
    letter-spacing: -1px;
    line-height: 1.1;
    margin-bottom: 16px;
  }
  h1 .accent  { color: var(--blue); }
  h1 .accent2 { color: var(--cyan); }

  .subtitle {
    font-size: 1rem;
    color: var(--muted);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.7;
  }

  .section-label {
    font-family: var(--mono);
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  .section-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 32px;
  }

  /* ‚îÄ‚îÄ Bug cards ‚îÄ‚îÄ */
  .bugs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 16px;
    margin-bottom: 64px;
  }

  .bug-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    position: relative;
    overflow: hidden;
    transition: border-color .2s, transform .2s;
  }
  .bug-card:hover { transform: translateY(-2px); }
  .bug-card.critical:hover { border-color: rgba(255,107,132,.4); }
  .bug-card.warning:hover  { border-color: rgba(255,181,71,.4);  }
  .bug-card.fixed:hover    { border-color: rgba(74,232,150,.4);  }
  .bug-card.session:hover  { border-color: rgba(91,163,255,.4);  }

  .bug-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
  }
  .bug-card.critical::before { background: linear-gradient(90deg, var(--red),    transparent); }
  .bug-card.warning::before  { background: linear-gradient(90deg, var(--amber),  transparent); }
  .bug-card.fixed::before    { background: linear-gradient(90deg, var(--green),  transparent); }
  .bug-card.session::before  { background: linear-gradient(90deg, var(--blue),   transparent); }

  .bug-id {
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 1px;
    padding: 2px 8px;
    border-radius: 4px;
    margin-bottom: 10px;
    display: inline-block;
  }
  .bug-id.critical { color: var(--red);   background: rgba(255,107,132,.1); }
  .bug-id.warning  { color: var(--amber); background: rgba(255,181,71,.1);  }
  .bug-id.fixed    { color: var(--green); background: rgba(74,232,150,.1);  }
  .bug-id.session  { color: var(--blue);  background: rgba(91,163,255,.1);  }

  .bug-name { font-size: .95rem; font-weight: 700; margin-bottom: 8px; }

  .bug-desc {
    font-size: .82rem;
    color: var(--muted);
    line-height: 1.6;
    margin-bottom: 12px;
  }

  .bug-fix {
    font-family: var(--mono);
    font-size: .75rem;
    color: var(--cyan);
    background: rgba(46,223,191,.06);
    border: 1px solid rgba(46,223,191,.15);
    border-radius: 6px;
    padding: 8px 10px;
    line-height: 1.5;
  }

  /* ‚îÄ‚îÄ Roadmap ‚îÄ‚îÄ */
  .roadmap { margin-bottom: 64px; }

  .priority-block { margin-bottom: 48px; }

  .priority-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
  }

  .priority-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: 0 0 10px currentColor;
  }
  .p-high   .priority-dot { color: var(--red);   background: var(--red);   }
  .p-medium .priority-dot { color: var(--amber); background: var(--amber); }
  .p-low    .priority-dot { color: var(--green); background: var(--green); }

  .priority-label {
    font-family: var(--mono);
    font-size: .7rem;
    letter-spacing: 2px;
    text-transform: uppercase;
  }
  .p-high   .priority-label { color: var(--red);   }
  .p-medium .priority-label { color: var(--amber); }
  .p-low    .priority-label { color: var(--green); }

  .priority-title { font-size: 1.1rem; font-weight: 700; }

  .items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 14px;
  }

  .item-card {
    background: var(--card2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 18px;
    display: flex;
    gap: 14px;
    align-items: flex-start;
    transition: border-color .2s, transform .2s;
    position: relative;
    overflow: hidden;
  }
  .item-card:hover { transform: translateY(-2px); }
  .p-high   .item-card:hover { border-color: rgba(255,107,132,.35); }
  .p-medium .item-card:hover { border-color: rgba(255,181,71,.35);  }
  .p-low    .item-card:hover { border-color: rgba(74,232,150,.35);  }

  /* Tarjeta completada */
  .item-card.done {
    opacity: .72;
    border-color: rgba(74,232,150,.2);
  }
  .item-card.done::before {
    content: '‚úì COMPLETADO';
    position: absolute;
    top: 8px; right: 10px;
    font-family: var(--mono);
    font-size: .6rem;
    font-weight: 700;
    letter-spacing: 1px;
    color: var(--green);
    background: rgba(74,232,150,.1);
    border: 1px solid rgba(74,232,150,.2);
    border-radius: 4px;
    padding: 2px 6px;
  }

  .item-id-box {
    width: 36px; height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--mono);
    font-size: .7rem;
    font-weight: 700;
    flex-shrink: 0;
  }
  .p-high   .item-id-box { background: rgba(255,107,132,.12); color: var(--red);   border: 1px solid rgba(255,107,132,.2); }
  .p-medium .item-id-box { background: rgba(255,181,71,.12);  color: var(--amber); border: 1px solid rgba(255,181,71,.2);  }
  .p-low    .item-id-box { background: rgba(74,232,150,.12);  color: var(--green); border: 1px solid rgba(74,232,150,.2);  }
  .item-card.done .item-id-box { background: rgba(74,232,150,.08); color: var(--green); border-color: rgba(74,232,150,.15); }

  .item-content { flex: 1; min-width: 0; }
  .item-name { font-size: .9rem; font-weight: 700; margin-bottom: 5px; }
  .item-desc { font-size: .79rem; color: var(--muted); line-height: 1.55; margin-bottom: 8px; }

  .item-tags { display: flex; flex-wrap: wrap; gap: 6px; }
  .tag {
    font-family: var(--mono);
    font-size: .65rem;
    padding: 2px 7px;
    border-radius: 4px;
    background: rgba(91,163,255,.08);
    color: var(--blue);
    border: 1px solid rgba(91,163,255,.15);
  }
  .tag.done-tag {
    background: rgba(74,232,150,.08);
    color: var(--green);
    border-color: rgba(74,232,150,.15);
  }

  /* ‚îÄ‚îÄ Stability ‚îÄ‚îÄ */
  .stability-section { margin-bottom: 64px; }
  .stability-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 14px;
  }
  .stability-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 22px;
    transition: border-color .2s, transform .2s;
  }
  .stability-card:hover { border-color: rgba(155,126,255,.4); transform: translateY(-2px); }
  .stability-icon { font-size: 1.4rem; margin-bottom: 12px; }
  .stability-name { font-size: .95rem; font-weight: 700; margin-bottom: 8px; color: var(--purple); }
  .stability-desc { font-size: .8rem; color: var(--muted); line-height: 1.6; }

  /* ‚îÄ‚îÄ Timeline ‚îÄ‚îÄ */
  .timeline { margin-bottom: 64px; }
  .tl-items {
    display: flex;
    flex-direction: column;
    gap: 0;
    border-left: 2px solid var(--border);
    padding-left: 28px;
    margin-left: 12px;
  }
  .tl-item { position: relative; padding: 0 0 40px; }
  .tl-item:last-child { padding-bottom: 0; }
  .tl-item::before {
    content: '';
    position: absolute;
    left: -36px; top: 5px;
    width: 12px; height: 12px;
    border-radius: 50%;
    border: 2px solid var(--border);
    background: var(--bg);
  }
  .tl-item.done::before    { background: var(--green);  border-color: var(--green);  box-shadow: 0 0 12px var(--green); }
  .tl-item.current::before { background: var(--blue);   border-color: var(--blue);   box-shadow: 0 0 12px var(--blue); }
  .tl-item.next::before    { background: var(--card2);  border-color: var(--amber);  }
  .tl-item.future::before  { background: var(--card2);  border-color: var(--muted);  }

  .tl-ver {
    font-family: var(--mono);
    font-size: .75rem;
    font-weight: 600;
    color: var(--muted);
    margin-bottom: 4px;
  }
  .tl-item.done .tl-ver    { color: var(--green); }
  .tl-item.current .tl-ver { color: var(--blue);  }
  .tl-item.next .tl-ver    { color: var(--amber); }

  .tl-title { font-size: 1rem; font-weight: 700; margin-bottom: 8px; }

  .tl-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .tl-list li {
    font-size: .8rem;
    color: var(--muted);
    display: flex;
    align-items: baseline;
    gap: 8px;
  }
  .tl-list li::before {
    content: '‚Üí';
    font-family: var(--mono);
    font-size: .7rem;
    color: var(--border);
    flex-shrink: 0;
  }
  .tl-item.done    .tl-list li::before { color: var(--green); }
  .tl-item.current .tl-list li::before { color: var(--blue);  }
  .tl-item.next    .tl-list li::before { color: var(--amber); }
  .tl-list li.done-li { color: var(--green); opacity: .8; }

  /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
  footer {
    text-align: center;
    font-family: var(--mono);
    font-size: .7rem;
    color: var(--muted);
    border-top: 1px solid var(--border);
    padding-top: 32px;
  }
  .chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-family: var(--mono);
    font-size: .7rem;
    color: var(--muted);
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 100px;
    padding: 4px 12px;
    margin: 4px;
  }
  .chip-dot { width: 6px; height: 6px; border-radius: 50%; }

  /* Banner de sesi√≥n */
  .session-banner {
    background: linear-gradient(135deg, rgba(91,163,255,.07), rgba(46,223,191,.05));
    border: 1px solid rgba(91,163,255,.2);
    border-radius: 14px;
    padding: 22px 26px;
    margin-bottom: 48px;
    display: flex;
    align-items: flex-start;
    gap: 16px;
  }
  .session-banner-icon { font-size: 1.8rem; flex-shrink: 0; }
  .session-banner-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--blue);
    margin-bottom: 6px;
  }
  .session-banner-desc {
    font-size: .82rem;
    color: var(--muted);
    line-height: 1.6;
  }
  .session-banner-chips { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 6px; }
  .schip {
    font-family: var(--mono);
    font-size: .65rem;
    padding: 2px 8px;
    border-radius: 4px;
    background: rgba(91,163,255,.08);
    color: var(--blue);
    border: 1px solid rgba(91,163,255,.15);
  }

  /* ‚îÄ‚îÄ RAM Optimization ‚îÄ‚îÄ */
  .ram-section { margin-bottom: 64px; }

  .ram-intro {
    background: linear-gradient(135deg, rgba(255,107,132,.06), rgba(255,181,71,.04));
    border: 1px solid rgba(255,107,132,.2);
    border-radius: 14px;
    padding: 22px 26px;
    margin-bottom: 32px;
    display: flex;
    align-items: flex-start;
    gap: 16px;
  }
  .ram-intro-icon { font-size: 2rem; flex-shrink: 0; }
  .ram-intro-title { font-size: 1rem; font-weight: 700; color: var(--red); margin-bottom: 6px; }
  .ram-intro-desc  { font-size: .82rem; color: var(--muted); line-height: 1.65; }
  .ram-intro-stats {
    margin-top: 14px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 10px;
  }
  .ram-stat {
    background: rgba(255,107,132,.06);
    border: 1px solid rgba(255,107,132,.15);
    border-radius: 8px;
    padding: 10px 14px;
    font-family: var(--mono);
  }
  .ram-stat-label { font-size: .65rem; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 3px; }
  .ram-stat-value { font-size: .9rem; font-weight: 700; color: var(--red); }
  .ram-stat-sub   { font-size: .65rem; color: var(--muted); }

  .ram-causes-title {
    font-family: var(--mono);
    font-size: .7rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--red);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .ram-causes-title::after { content:''; flex:1; height:1px; background: rgba(255,107,132,.2); }

  .ram-causes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 14px;
    margin-bottom: 36px;
  }

  .ram-cause {
    background: var(--card);
    border: 1px solid rgba(255,107,132,.18);
    border-radius: 12px;
    padding: 20px;
    position: relative;
    overflow: hidden;
    transition: transform .2s, border-color .2s;
  }
  .ram-cause:hover { transform: translateY(-2px); border-color: rgba(255,107,132,.4); }
  .ram-cause::before {
    content: '';
    position: absolute; top:0; left:0; right:0; height:2px;
    background: linear-gradient(90deg, var(--red), transparent);
  }
  .ram-cause-id {
    font-family: var(--mono);
    font-size: .65rem;
    font-weight: 700;
    letter-spacing: 1px;
    color: var(--red);
    background: rgba(255,107,132,.1);
    border: 1px solid rgba(255,107,132,.2);
    border-radius: 4px;
    padding: 2px 8px;
    display: inline-block;
    margin-bottom: 10px;
  }
  .ram-cause-name { font-size: .92rem; font-weight: 700; margin-bottom: 6px; }
  .ram-cause-desc { font-size: .79rem; color: var(--muted); line-height: 1.58; margin-bottom: 12px; }
  .ram-cause-impact {
    font-family: var(--mono);
    font-size: .73rem;
    color: var(--amber);
    background: rgba(255,181,71,.07);
    border: 1px solid rgba(255,181,71,.18);
    border-radius: 6px;
    padding: 7px 10px;
    line-height: 1.5;
  }

  .ram-fixes-title {
    font-family: var(--mono);
    font-size: .7rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--green);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .ram-fixes-title::after { content:''; flex:1; height:1px; background: rgba(74,232,150,.2); }

  .ram-fixes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 14px;
  }

  .ram-fix {
    background: var(--card);
    border: 1px solid rgba(74,232,150,.18);
    border-radius: 12px;
    padding: 20px;
    position: relative;
    overflow: hidden;
    transition: transform .2s, border-color .2s;
  }
  .ram-fix:hover { transform: translateY(-2px); border-color: rgba(74,232,150,.4); }
  .ram-fix::before {
    content: '';
    position: absolute; top:0; left:0; right:0; height:2px;
    background: linear-gradient(90deg, var(--green), transparent);
  }
  .ram-fix-header { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; }
  .ram-fix-icon {
    width: 34px; height: 34px;
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.1rem;
    background: rgba(74,232,150,.1);
    border: 1px solid rgba(74,232,150,.2);
    flex-shrink: 0;
  }
  .ram-fix-meta { flex: 1; }
  .ram-fix-id {
    font-family: var(--mono);
    font-size: .63rem;
    font-weight: 700;
    letter-spacing: 1px;
    color: var(--green);
    margin-bottom: 3px;
  }
  .ram-fix-name { font-size: .92rem; font-weight: 700; }
  .ram-fix-desc { font-size: .79rem; color: var(--muted); line-height: 1.58; margin-bottom: 12px; }
  .ram-fix-code {
    font-family: var(--mono);
    font-size: .72rem;
    color: var(--cyan);
    background: rgba(46,223,191,.06);
    border: 1px solid rgba(46,223,191,.15);
    border-radius: 6px;
    padding: 8px 11px;
    line-height: 1.6;
    white-space: pre-wrap;
  }
  .ram-fix-saving {
    margin-top: 10px;
    font-family: var(--mono);
    font-size: .7rem;
    color: var(--green);
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .ram-fix-saving::before { content: '‚Üì'; font-weight: 700; }

</style>
</head>
<body>

<div class="blob blob-1"></div>
<div class="blob blob-2"></div>
<div class="blob blob-3"></div>

<div class="container">

  <!-- ‚îÄ‚îÄ Header ‚îÄ‚îÄ -->
  <header>
    <div class="version-badge">SysOpt v2.2.0 ¬∑ En Desarrollo Activo</div>
    <h1><span class="accent">SYS</span><span class="accent2">OPT</span><br>Plan de Estabilidad y Mejora</h1>
    <p class="subtitle">An√°lisis de bugs corregidos, mejoras implementadas y v√≠as de evoluci√≥n para una aplicaci√≥n de optimizaci√≥n Windows robusta y escalable.</p>
  </header>

  <!-- ‚îÄ‚îÄ Banner sesi√≥n actual ‚îÄ‚îÄ -->
  <div class="session-banner">
    <div class="session-banner-icon">‚ö°</div>
    <div>
      <div class="session-banner-title">Sesi√≥n 2.2.0 ‚Üí 2.3.0 ‚Äî Optimizaci√≥n de RAM en curso</div>
      <div class="session-banner-desc">
        Script <code>SysOpt_2_2_0</code> completamente operativo: B4 (snapshots), exportaciones async con
        barra de progreso y bot√≥n <em>segundo plano</em>, carga de historial en background. Nueva sesi√≥n enfocada en
        <strong style="color:var(--amber)">reducci√≥n de consumo de RAM</strong> ‚Äî diagn√≥stico completo y v√≠as de optimizaci√≥n documentadas.
      </div>
      <div class="session-banner-chips">
        <span class="schip">‚úì B1 Filtro b√∫squeda</span>
        <span class="schip">‚úì B2 Men√∫ contextual</span>
        <span class="schip">‚úì B3 Exportar CSV</span>
        <span class="schip">‚úì A3 Auto-refresco</span>
        <span class="schip">‚úì C3 Persistencia config</span>
        <span class="schip">‚úì B4 Snapshots + historial async</span>
        <span class="schip">‚úì Exportaci√≥n HTML/CSV/Snap async</span>
        <span class="schip">‚úì Barra progreso + segundo plano</span>
        <span class="schip" style="color:var(--red);background:rgba(255,107,132,.08);border-color:rgba(255,107,132,.2)">üß† RAM: diagn√≥stico activo</span>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Bugs corregidos v2.0.x ‚îÄ‚îÄ -->
  <div class="section-label">Bugs corregidos en v2.0.x</div>
  <div class="section-title">üîß Fixes Aplicados ‚Äî Base estable</div>

  <div class="bugs-grid">

    <div class="bug-card critical">
      <div class="bug-id critical">BUG CR√çTICO ¬∑ TYPE_ALREADY_EXISTS</div>
      <div class="bug-name">Add-Type: ScanControl ya existe</div>
      <div class="bug-desc">Las clases C# <code>ScanControl</code>, <code>ParallelScanner</code> y <code>DiskItem</code> se recompilaban en cada ejecuci√≥n de la sesi√≥n de PowerShell, causando error fatal al relanzar sin cerrar la consola.</div>
      <div class="bug-fix">FIX: Guards if (-not ([PSTypeName]'NombreClase').Type) { Add-Type ‚Ä¶ } aplicados a los 3 bloques C#.</div>
    </div>

    <div class="bug-card critical">
      <div class="bug-id critical">BUG CR√çTICO ¬∑ A1 ‚Äî Explorador vac√≠o</div>
      <div class="bug-name">Runspace de escaneo no ve los tipos C#</div>
      <div class="bug-desc">El nuevo runspace creado para <code>ParallelScanner</code> no ten√≠a acceso a los assemblies C# ya compilados, causando que el √°rbol de carpetas no mostrara nada.</div>
      <div class="bug-fix">FIX: Se inyectan los assemblies al runspace via <code>Assembly.LoadFrom()</code> antes de invocar el script de fondo.</div>
    </div>

    <div class="bug-card critical">
      <div class="bug-id critical">BUG CR√çTICO ¬∑ A1 ‚Äî ParentKey ra√≠z incorrecta</div>
      <div class="bug-name">Carpetas de primer nivel sin parentKey v√°lida</div>
      <div class="bug-desc">El <code>bgScript</code> pasaba <code>$Root</code> como <code>parentKey</code>, pero <code>Refresh-DiskView</code> busca hijos de <code>'::ROOT::'</code>, causando que nada se renderice.</div>
      <div class="bug-fix">FIX: Se pasa <code>'::ROOT::'</code> como parentKey al llamar a <code>ParallelScanner.ScanDir()</code> en el nivel 0.</div>
    </div>

    <div class="bug-card critical">
      <div class="bug-id critical">BUG CR√çTICO ¬∑ A3 ‚Äî Pesta√±a Rendimiento vac√≠a</div>
      <div class="bug-name">Runspace de Rendimiento sin m√≥dulos Storage/NetAdapter</div>
      <div class="bug-desc">El runspace creado para <code>Update-PerformanceTab</code> no importaba los m√≥dulos necesarios, causando que <code>Get-PhysicalDisk</code> y <code>Get-NetAdapter</code> no existieran.</div>
      <div class="bug-fix">FIX: <code>Import-Module Storage/NetAdapter/NetTCPIP</code> inyectado en el runspace antes de invocar el scriptblock de rendimiento.</div>
    </div>

    <div class="bug-card warning">
      <div class="bug-id warning">BUG MEDIO ¬∑ CLOSURE</div>
      <div class="bug-name">Variable $async no capturada por el timer del explorador</div>
      <div class="bug-desc">La variable <code>$async</code> del runspace de escaneo no quedaba en scope cuando el <code>DispatcherTimer</code> disparaba su tick, causando <code>NullReference</code>.</div>
      <div class="bug-fix">FIX: Almacenado en <code>$script:DiskScanAsync</code> y <code>$script:DiskScanPS</code> para acceso global desde el timer.</div>
    </div>

    <div class="bug-card warning">
      <div class="bug-id warning">BUG MEDIO ¬∑ UI FREEZE</div>
      <div class="bug-name">Update-SystemInfo bloqueaba el hilo de UI</div>
      <div class="bug-desc"><code>Get-CimInstance</code> se ejecutaba s√≠ncronamente en el hilo principal, congelando la UI 200‚Äì800 ms cada 2 segundos.</div>
      <div class="bug-fix">FIX: Toda la l√≥gica WMI movida a un runspace con su propio DispatcherTimer de polling.</div>
    </div>

    <div class="bug-card fixed">
      <div class="bug-id fixed">FIX ¬∑ ADD_CLOSED</div>
      <div class="bug-name">Cleanup incompleto al cerrar la ventana</div>
      <div class="bug-desc">El evento <code>Add_Closed</code> no liberaba las nuevas variables del refactor de closure, dejando objetos vivos al relanzar.</div>
      <div class="bug-fix">FIX: Dispose de <code>$script:DiskScanPS</code> y null de <code>$script:DiskScanAsync</code> a√±adidos al handler de cierre.</div>
    </div>

  </div>

  <!-- ‚îÄ‚îÄ Bugs corregidos sesi√≥n 2.1.x ‚îÄ‚îÄ -->
  <div class="section-label">Bugs corregidos en v2.1.x ‚Äî Esta sesi√≥n</div>
  <div class="section-title">üõ†Ô∏è Fixes de la Sesi√≥n Actual</div>

  <div class="bugs-grid">

    <div class="bug-card session">
      <div class="bug-id session">BUG PARSER ¬∑ 2.1.x</div>
      <div class="bug-name">Error "Token inesperado" en .AddParameter con backtick</div>
      <div class="bug-desc">PowerShell no soporta encadenamiento de m√©todos con backtick entre l√≠neas. El explorador de archivos lanzaba <code>ParserError</code> al iniciar.</div>
      <div class="bug-fix">FIX: Consolidado en una sola l√≠nea: <code>[void]$ps.AddScript(‚Ä¶).AddParameter(‚Ä¶).AddParameter(‚Ä¶)</code></div>
    </div>

    <div class="bug-card session">
      <div class="bug-id session">OPTIMIZACI√ìN ¬∑ RAM 8 GB</div>
      <div class="bug-name">Consumo excesivo de memoria en equipos con poca RAM</div>
      <div class="bug-desc">El BATCH y el intervalo del timer eran fijos, sin considerar la RAM libre disponible. En equipos con 8 GB el explorador pod√≠a volverse lento o inestable.</div>
      <div class="bug-fix">FIX: BATCH y intervalo adaptativos seg√∫n FreePhysicalMemory: &lt;2 GB ‚Üí 50/250ms ¬∑ 2‚Äì4 GB ‚Üí 150/180ms ¬∑ &gt;4 GB ‚Üí 300/120ms.</div>
    </div>

    <div class="bug-card session">
      <div class="bug-id session">BUG ¬∑ COLAPSO UI</div>
      <div class="bug-name">Bloqueo de UI al colapsar carpetas en el explorador</div>
      <div class="bug-desc"><code>Refresh-DiskView</code> reconstru√≠a el <code>childMap</code> completo y re-ordenaba todos los grupos con <code>Sort-Object</code> en cada colapso/expansi√≥n, aunque los datos no hubiesen cambiado.</div>
      <div class="bug-fix">FIX: childMap cacheado en <code>$script:CachedChildMap</code>. Al colapsar solo se rehace el DFS de visibilidad ‚Äî sin Sort-Object, sin iterar AllScannedItems.</div>
    </div>

    <div class="bug-card session">
      <div class="bug-id session">BUG ¬∑ ARRAY.SORT</div>
      <div class="bug-name">Error "desplazamiento y longitud fuera de bounds" en Sort</div>
      <div class="bug-desc">PowerShell no convierte autom√°ticamente un scriptblock a <code>IComparer</code> en <code>[Array]::Sort</code>. El explorador lanzaba <code>ArgumentException</code> en bucle al intentar ordenar.</div>
      <div class="bug-fix">FIX: Reemplazado por <code>Sort-Object</code> con expression block. Solo se ejecuta al reconstruir el mapa (-RebuildMap), nunca al colapsar.</div>
    </div>

    <div class="bug-card session">
      <div class="bug-id session">BUG ¬∑ DFS ORDEN</div>
      <div class="bug-name">Orden de carpetas incorrecto tras el DFS con Stack</div>
      <div class="bug-desc">El DFS iterativo con <code>Stack[string]</code> mezclaba el orden de los hermanos con los hijos del nivel inferior al hacer Pop, rompiendo la ordenaci√≥n por tama√±o.</div>
      <div class="bug-fix">FIX: DFS con pila de frames <code>(parentKey, √≠ndiceActual)</code>. Recorre el mapa en orden garantizado sin recursi√≥n y sin mezclar niveles.</div>
    </div>

    <div class="bug-card session">
      <div class="bug-id session">BUG ¬∑ INTERVAL IF</div>
      <div class="bug-name">"Token 'if' inesperado" en argumento de m√©todo</div>
      <div class="bug-desc">PowerShell no permite un <code>if</code> inline dentro de los par√©ntesis de una llamada a m√©todo. <code>FromMilliseconds(if (‚Ä¶))</code> lanzaba <code>ParserError</code>.</div>
      <div class="bug-fix">FIX: El valor se calcula antes en <code>$scanIntervalMs = if (‚Ä¶)</code> y luego se pasa la variable: <code>FromMilliseconds($scanIntervalMs)</code>.</div>
    </div>

  </div>

  <!-- ‚îÄ‚îÄ Roadmap de mejoras ‚Üí v2.2.0 ‚îÄ‚îÄ -->
  <div class="section-label">V√≠as de mejora ‚Äî Pr√≥xima versi√≥n</div>
  <div class="section-title">üó∫Ô∏è Hoja de Ruta ‚Äî Objetivos v2.2.0</div>

  <div class="roadmap">

    <!-- Alta prioridad -->
    <div class="priority-block p-high">
      <div class="priority-header">
        <div class="priority-dot"></div>
        <div>
          <div class="priority-label">Prioridad Alta ¬∑ Funcionalidad Core</div>
          <div class="priority-title">Explorador de disco ‚Äî caracter√≠sticas completas</div>
        </div>
      </div>
      <div class="items-grid">
        <div class="item-card done">
          <div class="item-id-box">A1</div>
          <div class="item-content">
            <div class="item-name">Paralelismo y escaneo estable</div>
            <div class="item-desc">ParallelScanner funcionando con inyecci√≥n de assemblies, parentKey correcta y cola ConcurrentQueue.</div>
            <div class="item-tags"><span class="tag done-tag">‚úì Completado</span><span class="tag">C#</span><span class="tag">ParallelScanner</span></div>
          </div>
        </div>
        <div class="item-card">
          <div class="item-id-box">A2</div>
          <div class="item-content">
            <div class="item-name">Top 10 archivos ‚Äî pre-c√°lculo en hilo de escaneo</div>
            <div class="item-desc">Calcular los archivos m√°s grandes durante el escaneo principal y almacenarlos en el <code>DiskItem</code>, eliminando el delay al hacer clic en una carpeta.</div>
            <div class="item-tags"><span class="tag">A2</span><span class="tag">UX</span><span class="tag">Pre-c√°lculo</span></div>
          </div>
        </div>
        <div class="item-card done">
          <div class="item-id-box">A3</div>
          <div class="item-content">
            <div class="item-name">Auto-refresco de Rendimiento con timer configurable</div>
            <div class="item-desc"><code>chkAutoRefresh</code> con <code>$script:AutoRefreshTimer</code> e intervalo configurable. Se detiene correctamente en <code>Add_Closed</code> y se guarda en <code>settings.json</code>.</div>
            <div class="item-tags"><span class="tag done-tag">‚úì Implementado</span><span class="tag">DispatcherTimer</span></div>
          </div>
        </div>
        <div class="item-card" style="border-color:rgba(255,181,71,.35);">
          <div class="item-id-box" style="background:rgba(255,181,71,.12);color:var(--amber);border-color:rgba(255,181,71,.2);">FIX</div>
          <div class="item-content">
            <div class="item-name">Cancelaci√≥n limpia del timer de rendimiento <span style="font-size:.7rem;color:var(--amber);font-family:var(--mono);margin-left:6px;">‚ö° EN DESARROLLO</span></div>
            <div class="item-desc"><code>Update-PerformanceTab</code> corre en el hilo de UI. El <code>AutoRefreshTimer</code> se detiene en <code>Add_Closed</code>, pero falta guardia contra ticks durante el cierre.</div>
            <div class="item-tags"><span class="tag" style="color:var(--amber);background:rgba(255,181,71,.08);border-color:rgba(255,181,71,.2);">‚ö° En desarrollo</span><span class="tag">Estabilidad</span><span class="tag">Cleanup</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Media prioridad -->
    <div class="priority-block p-medium">
      <div class="priority-header">
        <div class="priority-dot"></div>
        <div>
          <div class="priority-label">Prioridad Media ¬∑ Funcionalidad</div>
          <div class="priority-title">Nuevas caracter√≠sticas de valor</div>
        </div>
      </div>
      <div class="items-grid">
        <div class="item-card done">
          <div class="item-id-box">B1</div>
          <div class="item-content">
            <div class="item-name">Filtro/b√∫squeda en el Explorador</div>
            <div class="item-desc">TextBox <code>txtDiskFilter</code> con <code>Apply-DiskFilter</code> en tiempo real, bot√≥n limpiar y estado guardado en <code>settings.json</code>.</div>
            <div class="item-tags"><span class="tag done-tag">‚úì Implementado</span><span class="tag">WPF</span><span class="tag">Filter</span></div>
          </div>
        </div>
        <div class="item-card done">
          <div class="item-id-box">B2</div>
          <div class="item-content">
            <div class="item-name">Men√∫ contextual en el √°rbol de carpetas</div>
            <div class="item-desc">ContextMenu oscuro tem√°tico con <code>ctxOpen</code>, <code>ctxCopy</code>, <code>ctxDelete</code>, <code>ctxScanFolder</code>. Estilo peligro en eliminar, habilitaci√≥n din√°mica por selecci√≥n.</div>
            <div class="item-tags"><span class="tag done-tag">‚úì Implementado</span><span class="tag">ContextMenu</span><span class="tag">WPF</span></div>
          </div>
        </div>
        <div class="item-card done">
          <div class="item-id-box">B3</div>
          <div class="item-content">
            <div class="item-name">Exportar resultados del Explorador a CSV</div>
            <div class="item-desc">Bot√≥n <code>btnExportCsv</code> con <code>SaveFileDialog</code> y <code>Export-Csv -Encoding UTF8</code>. Activo solo al finalizar el escaneo.</div>
            <div class="item-tags"><span class="tag done-tag">‚úì Implementado</span><span class="tag">CSV</span><span class="tag">Export</span></div>
          </div>
        </div>
        <div class="item-card" style="border-color:rgba(255,181,71,.35);">
          <div class="item-id-box" style="background:rgba(255,181,71,.12);color:var(--amber);border-color:rgba(255,181,71,.2);">B4</div>
          <div class="item-content">
            <div class="item-name">Historial de escaneos <span style="font-size:.7rem;color:var(--amber);font-family:var(--mono);margin-left:6px;">‚ö° EN DESARROLLO</span></div>
            <div class="item-desc">Guardar snapshots de escaneos en JSON en <code>%APPDATA%\SysOpt\snapshots\</code>. Interfaz para comparar el crecimiento de carpetas entre escaneos anteriores.</div>
            <div class="item-tags"><span class="tag" style="color:var(--amber);background:rgba(255,181,71,.08);border-color:rgba(255,181,71,.2);">‚ö° En desarrollo</span><span class="tag">JSON</span><span class="tag">Historial</span></div>
          </div>
        </div>
        <div class="item-card">
          <div class="item-id-box">B5</div>
          <div class="item-content">
            <div class="item-name">Detecci√≥n de archivos duplicados</div>
            <div class="item-desc">Hash SHA256 de archivos grandes (&gt;10 MB) durante el escaneo. Panel adicional que agrupe duplicados por hash y calcule el espacio recuperable.</div>
            <div class="item-tags"><span class="tag">B5</span><span class="tag">SHA256</span><span class="tag">Deduplication</span></div>
          </div>
        </div>
        <div class="item-card done">
          <div class="item-id-box">C3</div>
          <div class="item-content">
            <div class="item-name">Persistencia de configuraci√≥n</div>
            <div class="item-desc"><code>Save-Settings</code> guarda checkboxes, ruta del explorador y filtro en <code>%APPDATA%\SysOpt\settings.json</code>. Se restaura al arrancar y se guarda en <code>Add_Closed</code>.</div>
            <div class="item-tags"><span class="tag done-tag">‚úì Implementado</span><span class="tag">JSON</span><span class="tag">%APPDATA%</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Baja prioridad -->
    <div class="priority-block p-low">
      <div class="priority-header">
        <div class="priority-dot"></div>
        <div>
          <div class="priority-label">Prioridad Baja ¬∑ UX &amp; Polish</div>
          <div class="priority-title">Pulido y experiencia de usuario</div>
        </div>
      </div>
      <div class="items-grid">
        <div class="item-card">
          <div class="item-id-box">C1</div>
          <div class="item-content">
            <div class="item-name">Tema claro / oscuro</div>
            <div class="item-desc">Toggle en la toolbar. Mover colores del XAML a un <code>ResourceDictionary</code> intercambiable en runtime.</div>
            <div class="item-tags"><span class="tag">C1</span><span class="tag">Theming</span><span class="tag">XAML</span></div>
          </div>
        </div>
        <div class="item-card">
          <div class="item-id-box">C2</div>
          <div class="item-content">
            <div class="item-name">Notificaci√≥n Windows Toast al terminar</div>
            <div class="item-desc">Usar <code>[Windows.UI.Notifications.ToastNotificationManager]</code> para emitir una notificaci√≥n nativa al finalizar la optimizaci√≥n en segundo plano.</div>
            <div class="item-tags"><span class="tag">C2</span><span class="tag">Toast</span><span class="tag">WinRT</span></div>
          </div>
        </div>
        <div class="item-card">
          <div class="item-id-box">C4</div>
          <div class="item-content">
            <div class="item-name">Programador de tareas integrado</div>
            <div class="item-desc">Interfaz para crear/eliminar tareas en el Programador de Windows (<code>Register-ScheduledTask</code>) para optimizaciones autom√°ticas semanales.</div>
            <div class="item-tags"><span class="tag">C4</span><span class="tag">TaskScheduler</span><span class="tag">PowerShell</span></div>
          </div>
        </div>
      </div>
    </div>

  </div>


  <!-- ‚îÄ‚îÄ Optimizaci√≥n de RAM ‚îÄ‚îÄ -->
  <div class="section-label">An√°lisis de consumo ¬∑ v2.2.0</div>
  <div class="section-title">üß† Optimizaci√≥n de Consumo de RAM</div>

  <div class="ram-section">

    <!-- Intro con estimaciones reales -->
    <div class="ram-intro">
      <div class="ram-intro-icon">üìä</div>
      <div style="flex:1">
        <div class="ram-intro-title">Diagn√≥stico de consumo ‚Äî basado en el c√≥digo actual</div>
        <div class="ram-intro-desc">
          El script mantiene simult√°neamente tres colecciones que referencian los mismos objetos
          (<code>LiveItems</code>, <code>AllScannedItems</code>, <code>LiveList</code>), lo que es correcto y eficiente.
          El problema real son los <strong style="color:var(--red)">picos de RAM transitorios</strong> durante exportaciones
          y la <strong style="color:var(--red)">sobrecarga estructural de DiskItem_v211</strong> (17 campos, 10 strings)
          que acumula datos de presentaci√≥n junto a datos puros.
        </div>
        <div class="ram-intro-stats">
          <div class="ram-stat">
            <div class="ram-stat-label">10K carpetas</div>
            <div class="ram-stat-value">~22 MB</div>
            <div class="ram-stat-sub">pico exportaci√≥n HTML</div>
          </div>
          <div class="ram-stat">
            <div class="ram-stat-label">50K carpetas</div>
            <div class="ram-stat-value">~110 MB</div>
            <div class="ram-stat-sub">pico exportaci√≥n HTML</div>
          </div>
          <div class="ram-stat">
            <div class="ram-stat-label">100K carpetas</div>
            <div class="ram-stat-value">~220 MB</div>
            <div class="ram-stat-sub">pico exportaci√≥n HTML</div>
          </div>
          <div class="ram-stat">
            <div class="ram-stat-label">DiskItem_v211</div>
            <div class="ram-stat-value">~1,200 B</div>
            <div class="ram-stat-sub">por objeto (10 strings)</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Causas ra√≠z -->
    <div class="ram-causes-title">Causas ra√≠z identificadas</div>
    <div class="ram-causes-grid">

      <div class="ram-cause">
        <div class="ram-cause-id">RAM-01 ¬∑ ALTA</div>
        <div class="ram-cause-name">DiskItem con 10 strings de presentaci√≥n</div>
        <div class="ram-cause-desc">
          <code>DiskItem_v211</code> almacena permanentemente <code>SizeStr</code>, <code>SizeColor</code>,
          <code>PctStr</code>, <code>FileCount</code>, <code>Icon</code>, <code>Indent</code>, <code>BarColor</code>
          y <code>BarWidth</code> ‚Äî datos recalculados en cada tick del timer de todas formas.
          Con 100K carpetas representa ~114 MB de strings que podr√≠an derivarse en el momento de render.
        </div>
        <div class="ram-cause-impact">Impacto: ~800‚Äì1,100 bytes/objeto de overhead evitable</div>
      </div>

      <div class="ram-cause">
        <div class="ram-cause-id">RAM-02 ¬∑ ALTA</div>
        <div class="ram-cause-name">Copia completa de datos al exportar/guardar</div>
        <div class="ram-cause-desc">
          Tanto la exportaci√≥n HTML (<code>dataSnapshot</code>) como el guardado de snapshot (<code>snapData</code>)
          crean una copia completa de todos los items como <code>PSCustomObject</code> antes de pasarlos al runspace.
          Durante ese momento conviven en RAM: la colecci√≥n original + la copia + el StringBuilder del HTML.
        </div>
        <div class="ram-cause-impact">Impacto: 2‚Äì3√ó el consumo base durante exportaci√≥n</div>
      </div>

      <div class="ram-cause">
        <div class="ram-cause-id">RAM-03 ¬∑ MEDIA</div>
        <div class="ram-cause-name">StringBuilder HTML √≠ntegro en memoria</div>
        <div class="ram-cause-desc">
          El runspace de exportaci√≥n construye todo el HTML en un <code>StringBuilder</code> antes de escribir
          a disco. Para 100K carpetas eso supone ~50‚Äì80 MB de string en RAM simult√°neamente con los datos de origen,
          el template y el HTML final ensamblado ‚Äî tres copias del string en el mismo momento.
        </div>
        <div class="ram-cause-impact">Impacto: ~50‚Äì80 MB extra en pico para discos grandes</div>
      </div>

      <div class="ram-cause">
        <div class="ram-cause-id">RAM-04 ¬∑ MEDIA</div>
        <div class="ram-cause-name">Load-SnapshotList deserializa JSON completos</div>
        <div class="ram-cause-desc">
          Aunque el objeto <code>$data</code> se anula con <code>$data = $null</code> tras extraer metadatos,
          <code>ConvertFrom-Json</code> deserializa el √°rbol entero de entries en memoria antes de desecharlo.
          Con snapshots de 50K entradas esto puede representar 200‚Äì400 MB transitorios por archivo JSON.
        </div>
        <div class="ram-cause-impact">Impacto: 200‚Äì400 MB transitorios por snapshot grande</div>
      </div>

      <div class="ram-cause">
        <div class="ram-cause-id">RAM-05 ¬∑ MEDIA</div>
        <div class="ram-cause-name">ObservableCollection sin virtualizaci√≥n efectiva</div>
        <div class="ram-cause-desc">
          <code>LiveList</code> es un <code>ObservableCollection</code> sin l√≠mite de items. Aunque WPF aplica
          UI virtualization, los objetos <code>DiskItem</code> siguen en memoria completos para todos los nodos
          visibles y colapsados. El colapso no libera RAM ‚Äî solo oculta visualmente.
        </div>
        <div class="ram-cause-impact">Impacto: RAM lineal con n√∫mero de carpetas visible</div>
      </div>

      <div class="ram-cause">
        <div class="ram-cause-id">RAM-06 ¬∑ BAJA</div>
        <div class="ram-cause-name">Runspaces sin pool centralizado</div>
        <div class="ram-cause-desc">
          Cada operaci√≥n (escaneo, exportaci√≥n CSV, exportaci√≥n HTML, guardar snapshot, cargar snapshot,
          comparar) crea y destruye su propio runspace con <code>RunspaceFactory.CreateRunspace()</code>.
          El overhead por runspace es ~2‚Äì5 MB de InitialSessionState aunque no se use nada del m√≥dulo.
        </div>
        <div class="ram-cause-impact">Impacto: ~2‚Äì5 MB por operaci√≥n concurrente</div>
      </div>

    </div>

    <!-- Soluciones concretas -->
    <div class="ram-fixes-title">V√≠as de optimizaci√≥n ‚Äî ordenadas por impacto</div>
    <div class="ram-fixes-grid">

      <div class="ram-fix">
        <div class="ram-fix-header">
          <div class="ram-fix-icon">ü™∂</div>
          <div class="ram-fix-meta">
            <div class="ram-fix-id">FIX RAM-01 ¬∑ M√ÅXIMO IMPACTO</div>
            <div class="ram-fix-name">Reducir DiskItem a solo datos puros</div>
          </div>
        </div>
        <div class="ram-fix-desc">
          Eliminar de la clase C# los campos de presentaci√≥n: <code>SizeStr</code>, <code>SizeColor</code>,
          <code>PctStr</code>, <code>Icon</code>, <code>Indent</code>, <code>BarColor</code>, <code>BarWidth</code>.
          Mover ese c√°lculo al <code>DataTemplate</code> de WPF usando <code>IValueConverter</code> o
          un <code>MultiBinding</code>. El objeto en RAM pasa de ~1,200 B a ~180 B por carpeta.
        </div>
        <div class="ram-fix-code">// Clase reducida: solo datos can√≥nicos
public string DisplayName { get; set; }
public string FullPath    { get; set; }
public string ParentPath  { get; set; }
public long   SizeBytes   { get; set; }
public int    FileCount_N { get; set; }  // num√©rico
public int    DirCount    { get; set; }
public int    Depth       { get; set; }
public bool   HasChildren { get; set; }
// Todo lo visual ‚Üí IValueConverter en XAML</div>
        <div class="ram-fix-saving">Ahorro estimado: 75‚Äì85% de RAM por objeto (100K carpetas: ‚àí95 MB)</div>
      </div>

      <div class="ram-fix">
        <div class="ram-fix-header">
          <div class="ram-fix-icon">üåä</div>
          <div class="ram-fix-meta">
            <div class="ram-fix-id">FIX RAM-02 ¬∑ ALTO IMPACTO</div>
            <div class="ram-fix-name">Streaming al exportar HTML ‚Äî escritura en bloques</div>
          </div>
        </div>
        <div class="ram-fix-desc">
          En lugar de construir el HTML completo en un <code>StringBuilder</code>, usar un
          <code>StreamWriter</code> que escriba directamente al archivo en bloques. El template se divide
          en cabecera/cuerpo/pie. Las filas de la tabla se escriben de 500 en 500 sin acumular el string completo.
        </div>
        <div class="ram-fix-code">$sw = [System.IO.StreamWriter]::new($outFile, $false,
       [System.Text.Encoding]::UTF8, 65536)
$sw.Write($htmlHeader)  # cabecera del template
foreach ($batch in $allSorted | Batch 500) {
    $sw.Write((Build-RowsBatch $batch))
    $sw.Flush()          # escribe y libera buffer
}
$sw.Write($htmlFooter)
$sw.Close()</div>
        <div class="ram-fix-saving">Ahorro estimado: elimina pico de 50‚Äì80 MB del StringBuilder</div>
      </div>

      <div class="ram-fix">
        <div class="ram-fix-header">
          <div class="ram-fix-icon">üîó</div>
          <div class="ram-fix-meta">
            <div class="ram-fix-id">FIX RAM-03 ¬∑ ALTO IMPACTO</div>
            <div class="ram-fix-name">Pasar referencia directa al runspace ‚Äî sin copia</div>
          </div>
        </div>
        <div class="ram-fix-desc">
          Actualmente se crea <code>$dataSnapshot</code> / <code>$snapData</code> como copia de
          <code>AllScannedItems</code> para pasarlos al runspace. Usando un <code>SynchronizedList</code>
          o pasando directamente la referencia al <code>ObservableCollection</code> con un lock de lectura,
          se elimina la copia y el pico de duplicaci√≥n.
        </div>
        <div class="ram-fix-code"># En lugar de:
$copy = [List]::new(); foreach ($i in $all) { $copy.Add(...) }
# Usar directamente la lista original (readonly durante export):
$script:ExportLock = $true
[void]$ps.AddParameter("Data", $script:AllScannedItems)
# En el runspace: solo lectura, nunca modifica</div>
        <div class="ram-fix-saving">Ahorro estimado: elimina copia de 50‚Äì120 MB en escaneos grandes</div>
      </div>

      <div class="ram-fix">
        <div class="ram-fix-header">
          <div class="ram-fix-icon">üìù</div>
          <div class="ram-fix-meta">
            <div class="ram-fix-id">FIX RAM-04 ¬∑ MEDIO IMPACTO</div>
            <div class="ram-fix-name">Leer metadatos de snapshot con JsonTextReader</div>
          </div>
        </div>
        <div class="ram-fix-desc">
          <code>ConvertFrom-Json</code> deserializa el JSON entero antes de poder leer un solo campo.
          Usando <code>Newtonsoft.Json.JsonTextReader</code> (disponible sin NuGet en .NET 4.5+) o
          <code>System.Text.Json.Utf8JsonReader</code> se puede hacer streaming ‚Äî leer solo
          <code>Label</code>, <code>Date</code>, <code>RootPath</code> y contar <code>Entries</code>
          sin deserializar el √°rbol completo.
        </div>
        <div class="ram-fix-code">$reader = [System.Text.Json.Utf8JsonReader]::new($bytes)
# Solo lee los campos de metadatos del nivel ra√≠z
# y cuenta tokens de Entry sin deserializar objetos
# ‚Üí RAM proporcional a metadatos, no a entradas</div>
        <div class="ram-fix-saving">Ahorro estimado: ‚àí200 a ‚àí400 MB pico por snapshot grande al cargar lista</div>
      </div>

      <div class="ram-fix">
        <div class="ram-fix-header">
          <div class="ram-fix-icon">üèä</div>
          <div class="ram-fix-meta">
            <div class="ram-fix-id">FIX RAM-05 ¬∑ MEDIO IMPACTO</div>
            <div class="ram-fix-name">RunspacePool con InitialSessionState m√≠nimo</div>
          </div>
        </div>
        <div class="ram-fix-desc">
          Crear un √∫nico <code>RunspacePool</code> de m√≠n 1 / m√°x 3 runspaces con un
          <code>InitialSessionState</code> vac√≠o (<code>CreateDefault2()</code>) compartido.
          Los runspaces se reutilizan entre operaciones, eliminando el overhead de arranque y el
          InitialSessionState completo (~2‚Äì5 MB) que se carga por defecto con todos los m√≥dulos.
        </div>
        <div class="ram-fix-code">$iss  = [InitialSessionState]::CreateDefault2()
$pool = [RunspaceFactory]::CreateRunspacePool(1, 3, $iss, $Host)
$pool.Open()
# Todas las operaciones async reutilizan este pool
$ps = [PowerShell]::Create(); $ps.RunspacePool = $pool</div>
        <div class="ram-fix-saving">Ahorro estimado: ‚àí10 a ‚àí30 MB en uso sostenido con operaciones concurrentes</div>
      </div>

      <div class="ram-fix">
        <div class="ram-fix-header">
          <div class="ram-fix-icon">üóëÔ∏è</div>
          <div class="ram-fix-meta">
            <div class="ram-fix-id">FIX RAM-06 ¬∑ BAJO IMPACTO ‚Äî inmediato</div>
            <div class="ram-fix-name">GC agresivo post-exportaci√≥n + EmptyWorkingSet</div>
          </div>
        </div>
        <div class="ram-fix-desc">
          Tras cada exportaci√≥n o carga de snapshot, forzar una colecci√≥n completa y comprimir
          el LOH (Large Object Heap) con <code>GCSettings.LargeObjectHeapCompactionMode</code>,
          seguido de <code>EmptyWorkingSet</code> para devolver p√°ginas al SO.
          Ya existe la llamada a <code>EmptyWorkingSet</code> en el c√≥digo para la RAM f√≠sica.
        </div>
        <div class="ram-fix-code">[Runtime.GCSettings]::LargeObjectHeapCompactionMode =
    [Runtime.GCLargeObjectHeapCompactionMode]::CompactOnce
[GC]::Collect(2, [GCCollectionMode]::Forced, $true, $true)
[GC]::WaitForPendingFinalizers()
# Ya existe EmptyWorkingSet v√≠a P/Invoke en el script</div>
        <div class="ram-fix-saving">Ahorro real: libera RAM al SO m√°s r√°pido, reduce RSS visible</div>
      </div>

    </div>
  </div>

  <!-- ‚îÄ‚îÄ Estabilidad ‚îÄ‚îÄ -->
  <div class="section-label">V√≠as de estabilidad t√©cnica</div>
  <div class="section-title">üõ°Ô∏è Estabilidad de la Aplicaci√≥n</div>

  <div class="stability-section">
    <div class="stability-grid">

      <div class="stability-card">
        <div class="stability-icon">üîí</div>
        <div class="stability-name">Gesti√≥n robusta de Runspaces</div>
        <div class="stability-desc">Centralizar todos los runspaces en un <code>$script:RunspacePool</code> con <code>RunspacePoolFactory</code>. Limita threads simult√°neos y facilita el Dispose global al cerrar.</div>
      </div>

      <div class="stability-card">
        <div class="stability-icon">‚ö°</div>
        <div class="stability-name">InitialSessionState compartido</div>
        <div class="stability-desc">Crear un <code>InitialSessionState</code> pre-cargado con los m√≥dulos necesarios y reutilizarlo en todos los runspaces, evitando el import repetido.</div>
      </div>

      <div class="stability-card">
        <div class="stability-icon">üîÑ</div>
        <div class="stability-name">CancellationToken unificado</div>
        <div class="stability-desc">Usar un √∫nico <code>CancellationTokenSource</code> global vinculado a <code>ScanControl.Stop</code>. Parada limpia sin sleep polling de 150 ms.</div>
      </div>

      <div class="stability-card">
        <div class="stability-icon">üìã</div>
        <div class="stability-name">Logging estructurado</div>
        <div class="stability-desc">Funci√≥n centralizada que escriba a la UI, a un archivo de log rotante en <code>%TEMP%\SysOpt.log</code> y a un buffer en memoria para diagn√≥stico.</div>
      </div>

      <div class="stability-card">
        <div class="stability-icon">üß™</div>
        <div class="stability-name">Guard de tipos C# mejorado</div>
        <div class="stability-desc">Compilar los tipos C# a un DLL externo cargado con <code>Add-Type -Path</code>, eliminando la recompilaci√≥n por completo.</div>
      </div>

      <div class="stability-card">
        <div class="stability-icon">üîç</div>
        <div class="stability-name">WMI con timeout configurable</div>
        <div class="stability-desc">Envolver todas las llamadas CIM en un <code>CimSession</code> con <code>OperationTimeout</code> de 5 s para garantizar respuesta en sistemas con WMI da√±ado.</div>
      </div>

      <div class="stability-card">
        <div class="stability-icon">ü™ù</div>
        <div class="stability-name">Error boundary global</div>
        <div class="stability-desc">Handler <code>[System.AppDomain]::CurrentDomain.UnhandledException</code> que capture excepciones no controladas de runspaces, las logee y muestre un mensaje amigable.</div>
      </div>

      <div class="stability-card">
        <div class="stability-icon">üì¶</div>
        <div class="stability-name">Abstracci√≥n de la capa de datos</div>
        <div class="stability-desc">Extraer toda la l√≥gica WMI/CIM a funciones <code>Get-*Data</code> puras separadas del c√≥digo de rendering. Facilita testing y mantenimiento futuro.</div>
      </div>

    </div>
  </div>

  <!-- ‚îÄ‚îÄ Timeline ‚îÄ‚îÄ -->
  <div class="section-label">Roadmap de versiones</div>
  <div class="section-title">üìÖ Versiones Planificadas</div>

  <div class="timeline">
    <div class="tl-items">

      <div class="tl-item done">
        <div class="tl-ver">v2.0.3 ¬∑ COMPLETADO ‚úì</div>
        <div class="tl-title">Hotfix de estabilidad cr√≠tica</div>
        <ul class="tl-list">
          <li class="done-li">Guard anti-TYPE_ALREADY_EXISTS en 3 clases C#</li>
          <li class="done-li">Fix parentKey ::ROOT:: en explorador de disco</li>
          <li class="done-li">Inyecci√≥n de assemblies al runspace de escaneo</li>
          <li class="done-li">Import-Module en runspace de rendimiento</li>
          <li class="done-li">Update-SystemInfo as√≠ncrono (no bloquea UI)</li>
          <li class="done-li">Fix closure $async ‚Üí $script:DiskScanAsync</li>
          <li class="done-li">Cleanup completo en Add_Closed</li>
        </ul>
      </div>

      <div class="tl-item done">
        <div class="tl-ver">v2.1.5 ¬∑ COMPLETADO ‚úì</div>
        <div class="tl-title">Estabilidad del Explorador de Disco</div>
        <ul class="tl-list">
          <li class="done-li">Fix parser: .AddParameter con backtick multil√≠nea</li>
          <li class="done-li">Fix: "Token 'if' inesperado" en argumento de m√©todo</li>
          <li class="done-li">Memoria adaptativa seg√∫n RAM libre (BATCH + intervalo)</li>
          <li class="done-li">Colapso de carpetas sin bloqueo de UI (childMap cacheado)</li>
          <li class="done-li">Fix Array::Sort ‚Üí Sort-Object correcto</li>
          <li class="done-li">Orden mayor‚Üímenor garantizado (DFS con frame stack)</li>
        </ul>
      </div>

      <div class="tl-item current">
        <div class="tl-ver">v2.2.0 ¬∑ EN PROGRESO ‚ö°</div>
        <div class="tl-title">Funcionalidad completa del Explorador + Rendimiento</div>
        <ul class="tl-list">
          <li class="done-li">‚úì B1: Filtro por nombre en √°rbol de carpetas</li>
          <li class="done-li">‚úì B2: Men√∫ contextual (abrir, eliminar, copiar ruta)</li>
          <li class="done-li">‚úì B3: Exportar a CSV</li>
          <li class="done-li">‚úì A3: Auto-refresco configurable en pesta√±a Rendimiento</li>
          <li class="done-li">‚úì C3: Persistencia de configuraci√≥n en JSON</li>
          <li class="done-li">‚úì FIX: Guardia de cierre del timer de rendimiento</li>
          <li class="done-li">‚úì B4: Snapshots + carga async + bot√≥n segundo plano</li>
          <li class="done-li">‚úì Exportaciones HTML/CSV sin bloqueo de UI</li>
        </ul>
      </div>

      <div class="tl-item next">
        <div class="tl-ver">v2.3.0 ¬∑ FUTURO</div>
        <div class="tl-title">Historial, duplicados y estabilidad avanzada</div>
        <ul class="tl-list">
          <li>üß† RAM-01: Reducir DiskItem a datos puros (IValueConverter)</li>
          <li>üß† RAM-02: Exportaci√≥n HTML via StreamWriter (sin StringBuilder)</li>
          <li>üß† RAM-03: Pasar AllScannedItems por referencia al runspace</li>
          <li>üß† RAM-04: JsonTextReader para metadatos de snapshot</li>
          <li>üß† RAM-05: RunspacePool centralizado + InitialSessionState m√≠nimo</li>
          <li>B5: Deduplicaci√≥n por SHA256 en archivos grandes</li>
          <li>A2: Pre-c√°lculo de top 10 archivos durante el escaneo</li>
          <li>Error boundary global con UnhandledException</li>
        </ul>
      </div>

      <div class="tl-item future">
        <div class="tl-ver">v3.0.0 ¬∑ VISI√ìN</div>
        <div class="tl-title">Plataforma modular y extensible</div>
        <ul class="tl-list">
          <li>Tipos C# compilados a DLL externo (sin Add-Type)</li>
          <li>C1: Tema claro/oscuro con ResourceDictionary</li>
          <li>C4: Integraci√≥n con el Programador de tareas</li>
          <li>C2: Notificaciones Toast nativas de Windows</li>
          <li>Plugin system para m√≥dulos de limpieza externos</li>
        </ul>
      </div>

    </div>
  </div>

  <!-- ‚îÄ‚îÄ Footer ‚îÄ‚îÄ -->
  <footer>
    <p style="margin-bottom:12px;">SysOpt Windows Optimizer GUI ‚Äî Plan de desarrollo v2.2.0 ‚úì / v2.3.0 RAM Optimization (en progreso)</p>
    <div>
      <span class="chip"><span class="chip-dot" style="background:var(--green)"></span>v2.2.0 estable</span>
      <span class="chip"><span class="chip-dot" style="background:var(--red)"></span>v2.3.0 RAM opt. en progreso</span>
      
      <span class="chip"><span class="chip-dot" style="background:var(--blue)"></span>PowerShell + WPF</span>
      <span class="chip"><span class="chip-dot" style="background:var(--purple)"></span>C# inline types</span>
      <span class="chip"><span class="chip-dot" style="background:var(--cyan)"></span>Multi-runspace</span>
    </div>
  </footer>

</div>
</body>
</html>